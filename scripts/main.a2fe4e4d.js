!function(a){"use strict";a.module("uuid",[]).factory("uuid",function(){var a={"new":function(){function a(a){var b=(Math.random().toString(16)+"000000000").substr(2,8);return a?"-"+b.substr(0,4)+"-"+b.substr(4,4):b}return a()+a(!0)+a(!0)+a()},empty:function(){return"00000000-0000-0000-0000-000000000000"}};return a})}(window.angular),function(a,b){"use strict";b&&-1==b.event.props.indexOf("dataTransfer")&&b.event.props.push("dataTransfer");var c=a.module("whiteboard",["rx","uuid"]).config(["$sceDelegateProvider",function(a){var b=a.resourceUrlWhitelist();b.push("data:image**"),a.resourceUrlWhitelist(b)}]);c.controller("MainCtrl",["$scope","rx","uuid",function(a,b,c){a.images=[];var d=new b.Subject;a.fileStream=d,d.subscribe(function(a){console.log(a)});var e=a.fileDataStream=new b.Subject;e.subscribe(function(b){console.log(b),a.$apply(function(){a.images.push({_id:c.new(),file:b.file,data:b.data})})})}]),c.directive("uiProgress",["$compile",function(a){return{restrict:"EA",scope:{file:"="},compile:function(b){var c=b.html();return function(b,d){d.html(a(c)(b))}},controller:["$scope","rx",function(a,b){a.percentage=0;var c=a.file,d=a.$parent.fileDataStream,e=new FileReader,f=function(b){a.$apply(function(){a.percentage=b})};e.onprogress=function(a){a.lengthComputable&&f(Math.round(a.loaded/a.total*100))},b.Observable.fromEvent(e,"load").map(function(a){return f(100),{file:c,data:a.target.result}}).subscribe(d),e.readAsDataURL(c)}]}}]),c.directive("uiUpload",["$compile",function(a){return{restrict:"E",scope:{fileStream:"=",filter:"=",fileDataStream:"="},compile:function(b){var c=b.html();return function(b,d,e,f){var g=new RegExp(b.filter);b.fileStream.filter(function(a){return a.type.match(g)}).subscribe(function(a){f.addFile(a)}),d.html(a(c)(b))}},controller:["$scope",function(a){a.files=[],this.addFile=function(b){a.$apply(function(){a.files.push(b)})}}]}}]),c.directive("uiDrop",["rx",function(b){return{restrict:"A",scope:{fileStream:"=uiDropFileStream"},link:function(c,d){d.bind("dragover",function(b){return b.preventDefault(),b.dataTransfer.dropEffect="copy",a.element(d).addClass("on-drag-hover"),!1}),d.bind("dragleave drop",function(){a.element(d).removeClass("on-drag-hover")}),b.Observable.fromEvent(d,"drop").flatMap(function(a){a.preventDefault();var c=[];if(-1!==a.dataTransfer.types.indexOf("Files"))for(var d,e=0;d=a.dataTransfer.files[e];e++)c.push(d);return b.Observable.fromArray(c)}).subscribe(c.fileStream)}}}]),c.directive("uiDraggable",function(){return{restrict:"A",link:function(b,c){a.element(c).attr("draggable","true"),c.bind("dragstart",function(a){a.dataTransfer.effectAllowed="copy",a.dataTransfer.setData("text/html",this.innerHTML)})}}})}(window.angular,window.jQuery);